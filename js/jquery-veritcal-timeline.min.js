/**
 * Vertical timeline plugin for jQuery.  Data powered
 * by Google Docs.
 *
 * Sharing is using old APIs and breaks in some browsers.
 */(function(e,t,n){e.fn.verticalTimeline=function(t,n){var r={key:"",sheetName:"Posts",defaultDirection:"newest",defaultExpansion:"expanded",groupFunction:"groupSegmentByYear",sharing:!1,gutterWidth:56,width:"auto",handleResize:!1,tabletopOptions:{},columnMapping:{title:"title",title_icon:"title icon",date:"date",display_date:"display date",photo_url:"photo url",caption:"caption",body:"body",read_more_url:"read more url",title:"title"},postTemplate:'         <div class="item post">           <div class="inner">             <div class="timestamp">{{timestamp}}</div>             <div class="title">                 <h3>                 {{#if title_icon}}<img class="title-icon" src="{{title_icon}}" />{{/if}}                 {{title}}                 </h3>             </div>             <div class="date">{{display_date}}</div>             <div class="body">               {{#if photo_url}}                 <img src="{{photo_url}}" alt="">               {{/if}}               {{#if caption}}                 <div class="caption">({{caption}})</div>               {{/if}}               {{#if body}}                 <div class="text">{{{body}}}</div>               {{/if}}               <div class="clearfix">                 {{#if read_more_url}}                   <a target="_blank" class="more" href="{{read_more_url}}">READ MORE</a>                   {{#if sharing}}                     <div class="share">                       <a href="#" class="share-trigger"></a>                       <div class="share-popup">                         <a href="https://twitter.com/share" class="twitter-share-button" data-url="{{read_more_url}}" data-text="{{title}}" data-count="none">Tweet</a>                         <a class="facebook-share-button" name="fb_share" type="button" share_url="{{read_more_url}}">Share</a>                       </div>                     </div>                   {{/if}}                 {{/if}}               </div>             </div>           </div>         </div>       ',groupMarkerTemplate:'         <div class="item group-marker item-group-{{id}}" data-id="{{id}}">           <div class="inner">             <div class="inner2">               <div class="timestamp">{{timestamp}}</div>               <div class="group">{{groupDisplay}}</div>             </div>           </div>         </div>       ',buttonTemplate:'         <div class="vertical-timeline-buttons">           <div class="expand-collapse-buttons">             <a class="expand-all active" href="#"><span>Expand all</span></a>             <a class="collapse-all" href="#"><span>Collapse all</span></a>           </div>           <div class="sort-buttons">             <a class="sort-newest active" href="#"><span>Newest first</span></a>             <a class="sort-oldest" href="#"><span>Oldest first</span></a>           </div>         </div>       ',timelineTemplate:'         <div class="vertical-timeline-timeline">           <div class="line-container">             <div class="line"></div>           </div>         </div>       '},i=function(e,t,n){var r=(new Date(e.timestamp)).getFullYear(),i=r.toString(),s=i.slice(0,-1);return t[s]={id:s,groupDisplay:s+"0's",timestamp:n=="newest"?Date.parse("December 31, "+s+"9"):Date.parse("January 1, "+s+"0"),timestampStart:Date.parse("January 1, "+s+"0"),timestampEnd:Date.parse("December 31, "+s+"9")},t},s=function(e,t,n){var r=(new Date(e.timestamp)).getFullYear();return t[r]={id:r,groupDisplay:r,timestamp:n=="newest"?Date.parse("December 31, "+r):Date.parse("January 1, "+r),timestampStart:Date.parse("January 1, "+r),timestampEnd:Date.parse("December 31, "+r)},t},o=function(e,t,n){var r=(new Date(e.timestamp)).getMonth(),i=(new Date(e.timestamp)).getFullYear(),s=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],o=Date.parse(s[r]+" 1, "+i),u=Date.parse(s[(r+1)%12]+" 1, "+i),a=r+i*100;return t[a]={id:a,groupDisplay:s[r]+" "+i,timestamp:n=="newest"?u:o,timestampStart:o,timestampEnd:u},t},u=function(e,t,n){var r=(new Date(e.timestamp)).getMonth(),i=(new Date(e.timestamp)).getFullYear(),s=(new Date(e.timestamp)).getDate(),o=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],u=Date.parse(o[r]+" "+s+", "+i),a=Date.parse(o[r]+" "+(s+1)+", "+i),f=s+(r+i*100)*100;return t[f]={id:f,groupDisplay:o[r]+" "+s+", "+i,timestamp:n=="newest"?a:u,timestampStart:u,timestampEnd:a},t};return this.each(function(){var a=e(this),f={},l={},c=!1;if(t=="update"){var h=a.data("timelineConfig");if(!e.isArray(n)||!h)return;var p=h,f=a.data("groups")?a.data("groups"):{};p.data=n,c=!0}else{a.data("timelineConfig",{}),a.data("groups",{});var p=e.extend(!0,r,t);a.data("timelineConfig",e.extend(!0,{},p,{data:[]})),a.removeClass("vertical-timeline-container")}p.groupFunction=p.groupFunction==="groupSegmentByDay"?u:p.groupFunction,p.groupFunction=p.groupFunction==="groupSegmentByMonth"?o:p.groupFunction,p.groupFunction=p.groupFunction==="groupSegmentByYear"?s:p.groupFunction,p.groupFunction=p.groupFunction==="groupSegmentByDecade"?i:p.groupFunction,a.hasClass("vertical-timeline-container")||a.html(p.buttonTemplate+p.timelineTemplate),a.addClass("vertical-timeline-container"),l.setupTimeline=function(t,n){var r=Handlebars.compile(p.postTemplate),i=Handlebars.compile(p.groupMarkerTemplate);n&&(t=n.sheets(p.sheetName).all()),e.each(t,function(e,t){f=p.groupFunction(t,f,p.defaultDirection),t.sharing=p.sharing,a.find(".vertical-timeline-timeline").append(r(t))}),a.data("groups",f),e.each(f,function(e,t){a.find(".vertical-timeline-timeline").append(i(t))}),l.handleSharing(),l.handleExpanding(),l.handleSorting(),l.adjustWidth(),l.handleResizing(),a.find(".vertical-timeline-timeline").imagesLoaded(function(){a.find(".vertical-timeline-timeline").isotope({itemSelector:".item",transformsEnabled:!0,layoutMode:"spineAlign",spineAlign:{gutterWidth:p.gutterWidth},getSortData:{timestamp:function(e){return parseFloat(e.find(".timestamp").text())}},sortBy:"timestamp",sortAscending:p.defaultDirection=="newest"?!1:!0,itemPositionDataEnabled:!0,onLayout:function(e,t){l.adjustLine()}})})},l.updateTimeline=function(t,n){var r=Handlebars.compile(p.postTemplate),i=Handlebars.compile(p.groupMarkerTemplate);n&&(t=n.sheets(p.sheetName).all());var s="";e.each(t,function(e,t){f=p.groupFunction(t,f,p.defaultDirection),t.sharing=p.sharing,s+=r(t)}),a.data("groups",f),e.each(f,function(t,n){e(".group-marker.item-group-"+n.id).length==0&&(s+=i(n))});if(!s)return;var o=e(s);e.each(o,function(t,n){e(this).find(".inner").append(e('<a href="#" class="open-close"></a>').click(function(t){e(this).siblings(".body").slideToggle(function(){a.find(".vertical-timeline-timeline").isotope("reLayout")}),e(this).parents(".post").toggleClass("closed"),a.find(".expand-collapse-buttons a").removeClass("active"),t.preventDefault()}))}),a.find(".vertical-timeline-timeline").isotope("insert",o),l.adjustWidth(),e(window).trigger("resize")},l.handleSharing=function(){p.sharing&&(e.getScript("//static.ak.fbcdn.net/connect.php/js/FB.Share"),e.getScript("//platform.twitter.com/widgets.js"),a.find(".vertical-timeline-timeline .post .share").hover(function(){e(this).find(".share-trigger").addClass("over"),e(this).find(".share-popup").show()},function(){e(this).find(".share-trigger").removeClass("over"),e(this).find(".share-popup").hide()}))},l.handleExpanding=function(){a.find(".vertical-timeline-timeline .item.post").each(function(){e(this).find(".inner").append('<a href="#" class="open-close"></a>')}),p.defaultExpansion!="expanded"&&(a.find(".vertical-timeline-timeline .item").each(function(){var t=e(this);t.find(".body").hide(),t.find(".post").toggleClass("closed")}),a.find(".expand-collapse-buttons a").removeClass("active"),a.find(".expand-collapse-buttons a.collapse-all").addClass("active")),a.find(".vertical-timeline-timeline .item a.open-close").click(function(t){e(this).siblings(".body").slideToggle(function(){a.find(".vertical-timeline-timeline").isotope("reLayout")}),e(this).parents(".post").toggleClass("closed"),a.find(".expand-collapse-buttons a").removeClass("active"),t.preventDefault()}),a.find(".vertical-timeline-buttons a.expand-all").click(function(t){a.find(".post .body").css("display","block"),a.find(".vertical-timeline-timeline").isotope("reLayout"),a.find(".post").removeClass("closed"),a.find(".expand-collapse-buttons a").removeClass("active"),e(this).addClass("active"),t.preventDefault()}),a.find(".vertical-timeline-buttons a.collapse-all").click(function(t){a.find(".post .body").css("display","none"),a.find(".vertical-timeline-timeline").isotope("reLayout"),a.find(".post").addClass("closed"),a.find(".expand-collapse-buttons a").removeClass("active"),e(this).addClass("active"),t.preventDefault()})},l.handleSorting=function(){p.defaultDirection!="newest"&&(a.find(".sort-buttons a").removeClass("active"),a.find(".sort-buttons a.sort-oldest").addClass("active")),a.find(".sort-buttons a").click(function(t){var n=e(this);if(n.hasClass("active"))return!1;a.find(".sort-buttons a").removeClass("active"),n.addClass("active"),n.hasClass("sort-newest")?(l.updateGroupMarkers(!1),a.find(".vertical-timeline-timeline").isotope("reloadItems").isotope({sortAscending:!1})):(l.updateGroupMarkers(!0),a.find(".vertical-timeline-timeline").isotope("reloadItems").isotope({sortAscending:!0})),t.preventDefault()})},l.handleResizing=function(){p.handleResize===!0&&a.resize(function(){l.adjustWidth(),l.adjustLine()})},l.updateGroupMarkers=function(t){a.find(".group-marker").each(function(){var n=e(this),r=n.attr("data-id"),i=t?f[r].timestampStart:f[r].timestampEnd;n.find(".timestamp").text(i)})},l.adjustWidth=function(){var e=p.width,t=a.width(),n,r;p.width==="auto"&&(e=t+"px"),a.find(".vertical-timeline-timeline").width(e),n=a.find(".vertical-timeline-timeline").width(),r=n/2-p.gutterWidth/2-4,a.find(".vertical-timeline-timeline .post").width(r)},l.adjustLine=function(){var e=a.find(".item.last"),t=e.data("isotope-item-position"),n=e.find(".date").height(),r=e.find(".date").position(),i=parseInt(e.find(".inner").css("marginTop")),s=r==null?0:parseInt(r.top),o=t!=null&&t.y!=null?parseInt(t.y):0,u=o+i+s+n/2,f=a.find(".line"),l=a.find(".vertical-timeline-timeline"),c=l.width()/2-f.width()/2;f.height(u).css("left",c+"px")},l.parseRow=function(t){return e.each(p.columnMapping,function(e,n){n=n.split(" ").join(""),t[n]&&(t[e]=t[n])}),typeof t["date"]=="number"?t.timestamp=t.date:t.timestamp=Date.parse(t.date),t};if(e.isArray(p.data))data=[],e.each(p.data,function(e,t){data.push(l.parseRow(t))}),c?l.updateTimeline(data,!1):l.setupTimeline(data,!1);else{var d=e.extend({key:p.key,callback:l.setupTimeline,wanted:[p.sheetName],postProcess:l.parseRow},p.tabletopOptions);Tabletop.init(d)}})},e.Isotope.prototype._spineAlignReset=function(){this.spineAlign={colA:0,colB:0,lastY:-60}},e.Isotope.prototype._spineAlignLayout=function(t){var n=this,r=this.spineAlign,i=Math.round(this.options.spineAlign&&this.options.spineAlign.gutterWidth)||0,s=Math.round(this.element.width()/2);t.each(function(o,u){var a=e(this);a.removeClass("last").removeClass("top"),o==t.length-1&&a.addClass("last");var f,l;if(a.hasClass("group-marker")){var c=a.width();f=s-c/2,r.colA>=r.colB?(l=r.colA,l==0&&a.addClass("top"),r.colA+=a.outerHeight(!0),r.colB=r.colA):(l=r.colB,l==0&&a.addClass("top"),r.colB+=a.outerHeight(!0),r.colA=r.colB)}else{a.removeClass("left").removeClass("right");var h=r.colB>=r.colA;h?a.addClass("left"):a.addClass("right"),f=h?s-(a.outerWidth(!0)+i/2):s+i/2,l=h?r.colA:r.colB;if(l-r.lastY<=60){var p=60-Math.abs(l-r.lastY);a.find(".inner").css("marginTop",p),r.lastY=l+p}else a.find(".inner").css("marginTop",0),r.lastY=l;r[h?"colA":"colB"]+=a.outerHeight(!0)}n._pushPosition(a,f,l)})},e.Isotope.prototype._spineAlignGetContainerSize=function(){var e={};return e.height=this.spineAlign[this.spineAlign.colB>this.spineAlign.colA?"colB":"colA"],e},e.Isotope.prototype._spineAlignResizeChanged=function(){return!0}})(jQuery,window);